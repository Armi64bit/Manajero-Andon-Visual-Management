<button class="mb-3" nbButton status="info" (click)="goBackToDashboards()">Go Back to Dashboards</button>

<nb-stepper [(selectedIndex)]="currentStep">
  <nb-step label="Dashboard Settings">
    <div>
      <h2>Dashboard Settings</h2>
      <div class="form-group">
        <label for="dashboardName">Dashboard Name:</label>
        <input nbInput fullWidth type="text" id="dashboardName" placeholder="Enter dashboard name" [(ngModel)]="dashboard.name" required>
        <div *ngIf="!dashboard.name && currentStep === 0" class="error">Dashboard name is required</div>
      </div>
      <div class="form-group">
        <label for="refreshRate">Refresh Rate (seconds):</label>
        <input nbInput fullWidth type="number" id="refreshRate" min="1" [(ngModel)]="dashboard.refreshRate" required>
        <div *ngIf="!dashboard.refreshRate && currentStep === 0" class="error">Refresh rate is required</div>
      </div>
      <button nbButton status="primary" (click)="nextStep()" [disabled]="!dashboard.name || !dashboard.refreshRate">Next</button>
    </div>
  </nb-step>

  <nb-step label="Add Stations">
    <div>
      <h2>Add Stations</h2>
      <div class="form-group">
        <label for="stationName">Station Name:</label>
        <input nbInput fullWidth type="text" id="stationName" placeholder="Enter station name" [(ngModel)]="station.name" required>
        <div *ngIf="!station.name && currentStep === 1" class="error">Station name is required</div>
      </div>
      <div class="form-group">
        <label for="metricName">Metric Name:</label>
        <input nbInput fullWidth type="text" id="metricName" placeholder="Enter metric name" [(ngModel)]="station.metric_name" required>
        <div *ngIf="!station.metric_name && currentStep === 1" class="error">Metric name is required</div>
      </div>
      <div class="form-group">
        <label for="targetValue">Target Value:</label>
        <input nbInput fullWidth type="number" id="targetValue" min="0" placeholder="Enter target value" [(ngModel)]="station.target_value" required>
        <div *ngIf="!station.target_value && currentStep === 1" class="error">Target value is required</div>
      </div>
      <div class="form-group">
        <label for="icon">Icon:</label>
        <select required [(ngModel)]="station.icon">
          <option value="fa-cogs">Cogs</option>
          <option value="fa-tachometer-alt">Tachometer</option>
          <option value="fa-box">Box</option>
          <option value="fa-check-circle">Check Circle</option>
          <option value="fa-warehouse">Warehouse</option>
          <option value="fa-truck">Truck</option>
        </select>
        <div *ngIf="!station.icon && currentStep === 1" class="error">Icon is required</div>
      </div>
      <button nbButton status="primary" (click)="addStation()" [disabled]="!station.name || !station.metric_name || !station.target_value || !station.icon">Add Station</button>
      <div class="station-list">
        <div *ngFor="let s of dashboard.stations; let i = index" class="station-item">
          <nb-icon [icon]="s.icon" pack="fas"></nb-icon> {{ s.name }} - {{ s.metric_name }}
          <button nbButton status="danger" (click)="removeStation(i)">Remove</button>
        </div>
      </div>
      <button nbButton status="primary" (click)="nextStep()" [disabled]="dashboard.stations.length === 0">Next</button>
    </div>
  </nb-step>

  <nb-step label="Configure Thresholds">
    <div>
      <h2>Configure Thresholds</h2>
      <div class="form-group">
        <label for="warningThreshold">Warning Threshold (%):</label>
        <input nbInput fullWidth type="number" id="warningThreshold" min="0" max="100" [(ngModel)]="dashboard.thresholds[0].warning" required>
        <div *ngIf="!dashboard.thresholds[0].warning && currentStep === 2" class="error">Warning threshold is required</div>
      </div>
      <div class="form-group">
        <label for="criticalThreshold">Critical Threshold (%):</label>
        <input nbInput fullWidth type="number" id="criticalThreshold" min="0" max="100" [(ngModel)]="dashboard.thresholds[0].critical" required>
        <div *ngIf="!dashboard.thresholds[0].critical && currentStep === 2" class="error">Critical threshold is required</div>
      </div>
      <button nbButton status="primary" (click)="nextStep()" [disabled]="!dashboard.thresholds[0].warning || !dashboard.thresholds[0].critical">Preview Dashboard</button>
    </div>
  </nb-step>

  <nb-step label="Preview">
    <div>
      <h2>Dashboard Preview</h2>
      <ngx-dashboard></ngx-dashboard>
      <div *ngFor="let station of dashboard.stations" class="preview-station">

        <nb-card [nbTooltip]="station.name"  class="dashboard-card" (click)="openStationDetails(station)">
          <nb-card-header class="d-flex align-items-center">
            <i class="fas {{ station.icon }} dashboard-icon me-2"></i>
            <h5 class="mb-0 text-truncate">{{ station.name }}</h5>
          </nb-card-header>
          <nb-card-body class="text-center">
            <p
              class="station-metric"
              [ngClass]="{ 'animated-target': station.updated }"
            >
              {{ station.target_value }}
            </p>
          </nb-card-body>
          <nb-card-footer [ngClass]="{
            'bg-success': station.status === 'normal',
            'bg-warning': station.status === 'warning',
            'bg-danger': station.status === 'critical'
          }" class="text-center">
            <span class="badge badge-large text-light"> {{ station.status }}</span>
          </nb-card-footer>
        </nb-card>
      </div>
      <button nbButton status="success" (click)="generateDashboard()">Update Dashboard</button>
    </div>
  </nb-step>


</nb-stepper>
